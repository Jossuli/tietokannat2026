a) Kursorin teko

CREATE DEFINER=`root`@`localhost` PROCEDURE `kursori`(IN Ar varchar(5))

BEGIN
	/*Paikalliset muuttujat*/
	DECLARE arvos INT;
	DECLARE ID INT;
	/*Tosi, kun kursori menee taulun loppuun*/
	DECLARE done BOOLEAN;
	/*Haetaan kursoriin kaikki tiedot kahdesta sarakkeesta*/
	DECLARE arvos_cursor CURSOR for
	SELECT idArviointi,Arvosana FROM Arviointi;
	/* NOT FOUND-käsittelijä (kun rivit loppuu) */
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done=TRUE;
	/*Avataan kursori*/
	OPEN arvos_cursor;
	/*Aloitetaan silmukka*/
	arvos_loop: loop
	/*Sijoitetaan kursorin arvot rivi kerrallaan muuttujiin*/
	FETCH arvos_cursor INTO ID,arvos;
	/*Kun kaikki luettu, silmukasta ulos*/
	IF done=1 then
	CLOSE arvos_cursor;
	LEAVE arvos_loop;
	END IF;
	/*Päivitetään Arvosana-sarakkeen yksi rivi*/
    IF Ar='+' THEN
		UPDATE Arviointi SET Arvosana=arvos+1 WHERE idArviointi=ID AND
		Arvosana < 5;	
	ELSEIF Ar='-' THEN
		UPDATE Arviointi SET Arvosana=arvos-1 WHERE idArviointi=ID AND
		Arvosana > 0;
		END IF;
END loop arvos_loop;
END

Kutsutaan komennolla: mysql> call kursori('-');





b)
CREATE DEFINER=`root`@`localhost` PROCEDURE `Luokkamuutokset`()

BEGIN
	/*Paikalliset muuttujat*/
	DECLARE done INT DEFAULT FALSE;
    	DECLARE v_id INT;

	/*Haetaan kursoriin kaikki tiedot */
	DECLARE luokkatunnus_cursor CURSOR for
	SELECT idOpiskelija FROM Opiskelija where Luokkatunnus='TVT25SPL';
	/* NOT FOUND-käsittelijä (kun rivit loppuu) */
	DECLARE CONTINUE HANDLER FOR NOT FOUND SET done=TRUE;
	/*Avataan kursori*/
	OPEN luokkatunnus_cursor;
	/*Aloitetaan silmukka*/
	luokkatunnus_loop: loop
	/*Sijoitetaan kursorin arvot rivi kerrallaan muuttujiin*/
	FETCH luokkatunnus_cursor INTO v_id;
	/*Kun kaikki luettu, silmukasta ulos*/
	IF done=1 then
	CLOSE luokkatunnus_cursor;
	LEAVE luokkatunnus_loop;
	END IF;
	/*Päivitetään Luokkatunnus-sarakkeen rivi*/
	UPDATE Opiskelija SET Luokkatunnus='TVT25SP' WHERE idOpiskelija=v_id;
END loop luokkatunnus_loop;
END


Muutetaan komennolla mysql> call luokkamuutokset();